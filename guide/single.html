<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Grails Plugin Platform Core 1.0.M1-SNAPSHOT</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#overview"><strong>1</strong><span>Overview</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#uiextension"><strong>3</strong><span>UI Extensions</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>4</strong><span>Configuration API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#security"><strong>5</strong><span>Security API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#events"><strong>6</strong><span>Events API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#injection"><strong>7</strong><span>Injection API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#navigation"><strong>8</strong><span>Navigation API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#convention"><strong>9</strong><span>Convention API</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>APIs and Tags for advanced Plugin integration</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Grails Plugin Platform Core - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Marc Palmer (marc@grailsrocks.com), St√©phane Maldini (stephane.maldini@gmail.com)</p>
                            <p><strong>Version:</strong> 1.0.M1-SNAPSHOT</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#overview"><strong>1</strong><span>Overview</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#apis"><strong>1.1</strong><span>The APIs</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changelog"><strong>1.2</strong><span>Change log</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#knownissues"><strong>1.3</strong><span>Known Issues</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#uiextension"><strong>3</strong><span>UI Extensions</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#uix_tags"><strong>3.1</strong><span>Tags</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#uix_code"><strong>3.2</strong><span>Beans and utilities</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>4</strong><span>Configuration API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changing_config"><strong>4.1</strong><span>Changing Application and Plugin Config Values</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#declaring_configuration_options"><strong>4.2</strong><span>Declaring Configuration Options</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#accessing_plugin_config"><strong>4.3</strong><span>Accessing Plugin Config</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#security"><strong>5</strong><span>Security API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#security_implementing_bridge"><strong>5.1</strong><span>Implementing a Security Bridge</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#events"><strong>6</strong><span>Events API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#injection"><strong>7</strong><span>Injection API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#navigation"><strong>8</strong><span>Navigation API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#convention"><strong>9</strong><span>Convention API</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="overview">1 Overview</h1>
The Plugin Platform provides APIs and utilities that provide the glue required for advanced Grails plugin development and integration across multiple Grails versions, and turbo-charge the development of a new generation of plugins.<p class="paragraph"/>The founding principle is that these platform features should not be part of
Grails core because this would tie plugins that use the APIs to specific Grails versions.<p class="paragraph"/>This relative freedom from Grails versions means that plugins that use the platform should remain compatible with more Grails versions for longer, and that new features used by all plugins can be added outside of the Grails release cycle.<p class="paragraph"/>


<h2 id="apis">1.1 The APIs</h2>
The features include in this release include:
<ul class="star">
<li>Configuration API - Plugin-namespaced config, Config merging, validation and default values</li>
<li>Security API - An abstraction of basic security features that most applications require, with implementations to be provided by plugins or your application</li>
<li>UI Extensions - A set of tags and helper functions</li>
</ul><p class="paragraph"/>Each feature is covered in more detail later in this documentation.<p class="paragraph"/>The platform is very self-referential - it uses own APIs - for example to provide event hooks for Grails application lifecycle, to declare dynamic methods on your controller and service artefacts, and to declare the configuration values that it uses.<p class="paragraph"/>All of these APIs are designed to be as simple as possible while providing some very high level features.<p class="paragraph"/>Use this platform to add tighter and more consistent integration to your own plugins.


<h2 id="changelog">1.2 Change log</h2>
<h3>1.0.M1</h3><p class="paragraph"/>First public release with Config and Security APIs and some UI Extensions. Work-in-progress APIs for Events, Injection, Conventions and Navigation.



<h2 id="knownissues">1.3 Known Issues</h2>
<h3>1.0.M1</h3>
<ul class="star">
<li>Config API - false validation errors with platform-ui due to no x.y.'*' support yet</li>
<li>Navigation API - controllers do not auto-register in Grails 1.3.x, no DSL artefact, no reloading</li>
<li>Conventions API - API not for public use. Not fully implemented / TBD</li>
<li>Events - API not for public use. Scopes not fully implemented / TBD</li>
<li>Injection - injection may not re-apply dynamic methods and properties to reloaded or new artefacts, API is not for public use at all yet</li>
</ul><p class="paragraph"/>


<h1 id="gettingStarted">2 Getting Started</h1>
To get started you need to install the platform-core plugin.<p class="paragraph"/>Add the plugin platform as a dependency to your application or plugin, either directly or transitively. To do so directly edit your <code>BuildConfig.groovy</code> to look something like this:<p class="paragraph"/><div class="code"><pre>&#8230;
    plugins &#123;
        &#8230;
        compile <span class="java&#45;quote">"&#58;platform&#45;core&#58;1.0.M1"</span>
    &#125;</pre></div><p class="paragraph"/>You can run your code now and browse to <code>http://localhost:8080/&#60;appname&#62;/platform/</code>, a special page available only in the development environment. From there you can explore some of the plugin platform features in the debug interface.<p class="paragraph"/>There is no default security implementation for the Security API, this will need to come from the security plugin you use, or your application. See <a href="../guide/single.html#security_implementing_bridge" class="guide">implementing a security bridge</a><p class="paragraph"/>


<h1 id="uiextension">3 UI Extensions</h1>
Several simple UI Extensions are included in platform-core.<p class="paragraph"/>The tags supplied make it trivial to render links to controllers and actions
using i18n messages, display messages to the end user, and render buttons and
labels in i18n friendly ways.



<h2 id="uix_tags">3.1 Tags</h2>

<h3>Linking tags</h3><p class="paragraph"/>The <a href="../ref/Tags Ui Extension/g:smartLink.html" class="tagsUiExtension">g:smartLink</a> tag renders links for controllers and actions, automatically working out the text of the link using i18n.<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;%&#45;&#45; Link to default action of BooksController &#45;&#45;%&#62;</span>
<span class="xml&#45;tag">&#60;g:smartLink controller=<span class="xml&#45;quote">"books"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;%&#45;&#45; Link to list action of current controller &#45;&#45;%&#62;</span>
<span class="xml&#45;tag">&#60;g:smartLink action=<span class="xml&#45;quote">"list"</span>/&#62;</span></pre></div><p class="paragraph"/>These will use i18n messages located by convention of the form: <code>action.<strong class="bold">controllerName</strong>.<strong class="bold">actionName</strong></code><p class="paragraph"/><h3>Label tag</h3><p class="paragraph"/>The label tag will render a &#60;label&#62; with the text optionally loaded from i18n:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:label text=<span class="xml&#45;quote">"field.user.name"</span>/&#62;</span></pre></div><p class="paragraph"/>See <a href="../ref/Tags Ui Extension/g:label.html" class="tagsUiExtension">g:label</a> for full details of the attributes, which include passing arguments to the i18n message.<p class="paragraph"/><h3>Button tag</h3><p class="paragraph"/>The button tag will render a text-based button using either a &#60;button&#62;, &#60;input type="submit"&#62; or &#60;a&#62; tag, with the text optionally loaded from i18n:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:button text=<span class="xml&#45;quote">"button.save"</span>/&#62;</span></pre></div><p class="paragraph"/>See <a href="../ref/Tags Ui Extension/g:button.html" class="tagsUiExtension">g:button</a> for full details of the attributes, which include setting the kind of button rendered and passing arguments to the i18n message.<p class="paragraph"/><h3>Display message tag</h3><p class="paragraph"/>The displayMessage tag works with the <code>displayMessage</code> and <code>displayFlashMessage</code> controller methods to make it easy to render messages to the user in a uniform way.<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:displayMessage/&#62;</span></pre></div><p class="paragraph"/>See <a href="../ref/Tags Ui Extension/g:displayMessage.html" class="tagsUiExtension">g:displayMessage</a> for full details of the attributes and the <a href="../ref/Controller Methods/displayMessage.html" class="Controller Methods">displayMessage</a> and <a href="../ref/Controller Methods/displayFlashMessage.html" class="Controller Methods">displayFlashMessage</a> controller methods.<p class="paragraph"/>The tag will render both request and flash messages, and wraps them in a div with CSS classes according to the type of message.<p class="paragraph"/><h3>Branding tags</h3><p class="paragraph"/>There are several simple but useful site branding tags included. Commonly to be used in site footers and emails templates.
<ul class="star">
<li><a href="../ref/Tags Ui Extension/g:organization.html" class="tagsUiExtension">g:organization</a> - Renders the name of the business, taken from Config var <code>plugin.platformCore.organization.name</code></li>
<li><a href="../ref/Tags Ui Extension/g:siteName.html" class="tagsUiExtension">g:siteName</a> - Renders the name of the site/product, taken from Config var <code>plugin.platformCore.site.name</code></li>
<li><a href="../ref/Tags Ui Extension/g:siteURL.html" class="tagsUiExtension">g:siteURL</a> - Renders an absolute URL for the root of the site</li>
<li><a href="../ref/Tags Ui Extension/g:siteLink.html" class="tagsUiExtension">g:siteLink</a> - Renders an absolute link to the site, with the site name as the link text</li>
<li><a href="../ref/Tags Ui Extension/g:year.html" class="tagsUiExtension">g:year</a> - Renders the current year, for use in copyright footers</li>
</ul><p class="paragraph"/>


<h2 id="uix_code">3.2 Beans and utilities</h2>
There are a some UI utility classes and beans:
<ul class="star">
<li><a href="../ref/Beans/grailsUiHelper.html" class="beans">grailsUiHelper</a> - Provides methods for setting and getting displayMessages</li>
<li><a href="../ref/Utility Classes/TagLibUtils.html" class="utilityClasses">TagLibUtils</a> - Provides helper functions for manipulating attributes, CSS class name lists etc.</li>
</ul><p class="paragraph"/>


<h1 id="configuration">4 Configuration API</h1>
The Configuration API adds the following features:
<ul class="star">
<li>A way to declare the Config properties that a plugin supports</li>
<li>Automatic namespacing of plugin Config values to avoid clashes</li>
<li>Validation of Config values</li>
<li>Merging of config from plugins into main Application config</li>
<li>The ability for plugins to configure other plugins</li>
<li>An injected "pluginConfig" variable in all artefacts containing the plugin's configuration</li>
</ul><p class="paragraph"/>All of this adds up to more powerful integration and less frustration and confusion for developers.



<h2 id="changing_config">4.1 Changing Application and Plugin Config Values</h2>
To change application or plugin configuration from within a plugin you need to declare the <strong class="bold">doWithConfig</strong> hook in your plugin descriptor.<p class="paragraph"/>The code uses a simple DSL that is identical to normal Config except:
<ol>
<li>The top level nodes are plugin names or "application" to determine what scope of config you are changing</li>
<li>The closure is passed the existing config as its first and only argument</li>
</ol><p class="paragraph"/>The application Config is loaded first. All the doWithConfig blocks are evaluated and the results merged in.<p class="paragraph"/><div class="code"><pre>def doWithConfig = &#123; config &#45;&#62;
    platformUi &#123;
        ui.Bootstrap.button.cssClass = 'btn'
        ui.Bootstrap.tab.cssClass = 'tab&#45;pane'
        ui.Bootstrap.field.cssClass = 'input'
    &#125;<p class="paragraph"/>    application &#123;
        // set something based on another config value that has already been
        // by the application
        grails.x.y = confg.p.q == 'somethign' ? <span class="java&#45;keyword">true</span> : <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The plugin name scope is the camel case beanNameConventionStyle. So the above is setting config values for the "grails-platform-ui" plugin.<p class="paragraph"/>Any values within a plugin scoped block as in the first block above, are merged into the main Config under <code>plugin.&#60;pluginName&#62;</code>. It is therefore impossible to change global Config values within a plugin config block.<p class="paragraph"/>Values inside the "application" block are merged into the root level of the application Config, so you can set any normal value.


<h2 id="declaring_configuration_options">4.2 Declaring Configuration Options</h2>
To make use of the plugin configuration features and make life easier for developers, your plugin must define the configuration options it accepts.<p class="paragraph"/>This allows the platform to warn users when they mistype a config name or supply and invalid value - and to formalize definition of default values rather than a plugin merging in default values.<p class="paragraph"/>Do declare the options your plugin supports, add the <code>doWithConfigOptions</code>  closure to your plugin descriptor:<p class="paragraph"/><div class="code"><pre>def doWithConfigOptions = &#123;
    'organization.name'(type: <span class="java&#45;object">String</span>, defaultValue: 'My Corp (set plugin.platformCore.organization.name)')
    'site.name'(type: <span class="java&#45;object">String</span>, defaultValue: 'Our App (set plugin.platformCore.site.name)')
&#125;</pre></div><p class="paragraph"/>This block, from the platform core, defines two configuration values of type String, with a default value.<p class="paragraph"/>You can also supply a custom validator:<p class="paragraph"/><div class="code"><pre>def doWithConfigOptions = &#123;
    'concurrentConnections'(type: <span class="java&#45;object">Integer</span>, defaultValue: 10, 
        validator: &#123; v &#45;&#62; v &#60; 500 ? <span class="java&#45;keyword">null</span> : 'concurrent.connections.too.big' &#125;
&#125;</pre></div><p class="paragraph"/>Behaving just like constraint validators, your validator returns null for "ok" or an i18n message string for the error.<p class="paragraph"/>


<h2 id="accessing_plugin_config">4.3 Accessing Plugin Config</h2>
Plugins that declare their configuration with <a href="../ref/Plugin Conventions/doWithConfigOptions.html" class="pluginConventions">doWithConfigOptions</a> can get access 
to their "slice" of the Config using the <a href="../ref/Global Properties/pluginConfig.html" class="globalProperties">pluginConfig</a> variable.<p class="paragraph"/>The <code>pluginConfig</code> variable is automatically injected into all artefacts of
your plugin, automatically namespace for your plugin using the <code>plugin.&#60;pluginName&#62;.</code> prefix.<p class="paragraph"/>So in a service you can trivially access this config inside a service or controller for example:<p class="paragraph"/><div class="code"><pre>class MyPluginService &#123;
    def doSomething() &#123;
       <span class="java&#45;keyword">if</span> (pluginConfig.enabled) &#123;
          println <span class="java&#45;quote">"It worked!"</span>
       &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>


<h1 id="security">5 Security API</h1>
The Security API provides common security related functionality so that plugins and in some cases applications no longer need to be tied to a specific security implementation.<p class="paragraph"/>It is deliberately minimal to place few requirements on implementations.<p class="paragraph"/>It is not intended to be a complete security abstraction, but "just enough" for the needs of most applications and plugins that do not require advanced security manipulation - which will likely always require direct knowledge of the underlying provider.<p class="paragraph"/>This API provides the most basic security features to enable this
interoperatibility, using a bridging interface that security plugins must
implement to actually provide these services.<p class="paragraph"/>Security plugins must implement the "provider" bean - out of the box there is no security implementation.<p class="paragraph"/><h3>Dynamic methods</h3><p class="paragraph"/>These methods are added to Services, Controllers, TagLibs and Domain Classes:
<ul class="star">
<li>getSecurityIdentity() - The string used to identify the current logged in user. Typically a user id, user name or email address. The nature of this value is dependent on your security implementation</li>
<li>getSecurityInfo() - The object representing the current logged in user's information.</li>
<li>userHasAnyRole(roleOrRoles) - test if the current user has any of the roles</li>
<li>userHasAllRoles(roleOrRoles) - test if the current user has all of the roles</li>
<li>userIsAllowed(object, action) - test if the current user has a specified permission on an object</li>
<li>withUser(identity) - run a section of code as another user</li>
</ul><p class="paragraph"/>See the reference guide for further details on these.<p class="paragraph"/><h3>Tags</h3><p class="paragraph"/>Here's an example of some of the security tags available:<p class="paragraph"/><div class="code"><pre>&#60;s:identity/&#62;
&#60;s:info property=<span class="java&#45;quote">"email"</span>/&#62;
&#60;s:ifPermitted role=<span class="java&#45;quote">"ROLE_ADMIN"</span>&#62;
    &#8230;
&#60;/s:ifPermitted&#62;
&#60;s:ifNotPermitted role=<span class="java&#45;quote">"ROLE_ADMIN"</span>&#62;
    &#8230;
&#60;/s:ifNotPermitted&#62;
&#60;a href=<span class="java&#45;quote">"$&#123;s.createLoginLink()&#125;"</span>&#62;Log in&#60;/a&#62;
&#60;a href=<span class="java&#45;quote">"$&#123;s.createLogoutLink()&#125;"</span>&#62;Log out&#60;/a&#62;
&#60;a href=<span class="java&#45;quote">"$&#123;s.createSignupLink()&#125;"</span>&#62;Sign up&#60;/a&#62;</pre></div><p class="paragraph"/><h3>grailsSecurity bean</h3><p class="paragraph"/>The Security bean provides access to all the basic security functions. These are passed through to the security bridge implementation.<p class="paragraph"/>This includes methods for applications and plugins to use such as:
<ul class="star">
<li>String getUserIdentity()</li>
<li>def getUserInfo()</li>
<li>boolean userHasRole(role)</li>
<li>boolean userIsAllowed(object, action)</li>
<li>def ifUserHasRole(role, Closure code)</li>
</ul><p class="paragraph"/>You simply auto wire this bean into your classes using the name "grailsSecurity"<p class="paragraph"/>For more details see <a href="../ref/Beans/grailsSecurity.html" class="beans">grailsSecurity</a>.


<h2 id="security_implementing_bridge">5.1 Implementing a Security Bridge</h2>
To use the Security API, an application must have a Security Bridge bean that implements the <a href="../gapi/org/grails/plugin/platform/security/SecurityBridge.html" class="api">SecurityBridge</a> interface,<p class="paragraph"/>Typically this bean will be provided by the security plugin you are using. However you can easily implement your own in your own plugin or application.<p class="paragraph"/>Simply implement the interface and register the bean as "grailsSecurityBridge" in your Spring context either in a plugin's <code>doWithSpring</code> or your application's <code>resources.groovy</code>:<p class="paragraph"/><div class="code"><pre>grailsSecurityBridge(com.mycorp.security.MySecurityProvider) &#123;
    // wire in any other dependencies it has
    grailsApplication = ref('grailsApplication')
&#125;</pre></div><p class="paragraph"/>The interface is defined here:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">interface</span> SecurityBridge &#123;<p class="paragraph"/>    /&#42;&#42;
     &#42; Implementations must <span class="java&#45;keyword">return</span> the name of their security provider 
     &#42; @<span class="java&#45;keyword">return</span> A name such as <span class="java&#45;quote">"Spring Security"</span>
     &#42;/
    <span class="java&#45;object">String</span> getProviderName()<p class="paragraph"/>    /&#42;&#42;
     &#42; Get user id string i.e. <span class="java&#45;quote">"marcpalmer"</span> of the currently logged in user, from whatever
     &#42; underlying security API is in force
     &#42; @<span class="java&#45;keyword">return</span> the user name / identity <span class="java&#45;object">String</span> or <span class="java&#45;keyword">null</span> <span class="java&#45;keyword">if</span> nobody is logged in
     &#42;/
    <span class="java&#45;object">String</span> getUserIdentity()<p class="paragraph"/>    /&#42;&#42;
     &#42; Get user info object containing i.e. email address, other stuff defined by the security implementation
     &#42; @<span class="java&#45;keyword">return</span> the implementation's user object or <span class="java&#45;keyword">null</span> <span class="java&#45;keyword">if</span> nobody is logged in
     &#42;/
    def getUserInfo()<p class="paragraph"/>    /&#42;&#42;
     &#42; Return <span class="java&#45;keyword">true</span> <span class="java&#45;keyword">if</span> the current logged in user has the specified role
     &#42;/
    <span class="java&#45;object">boolean</span> userHasRole(role)<p class="paragraph"/>    /&#42;&#42;
     &#42; Can the current user access <span class="java&#45;keyword">this</span> object to perform the named action?
     &#42; @param object The object, typically domain but we don't care what
     &#42; @param action Some application&#45;defined action string i.e. <span class="java&#45;quote">"view"</span> or <span class="java&#45;quote">"edit"</span>
     &#42;/
    <span class="java&#45;object">boolean</span> userIsAllowed(object, action)<p class="paragraph"/>    /&#42;&#42;
     &#42; Create a link to the specified security action
     &#42; @param action One of <span class="java&#45;quote">"login"</span>, <span class="java&#45;quote">"logout"</span>, <span class="java&#45;quote">"signup"</span>
     &#42; @<span class="java&#45;keyword">return</span> Must <span class="java&#45;keyword">return</span> a Map of arguments to pass to g:link to create the link
     &#42;/
    Map createLink(<span class="java&#45;object">String</span> action)<p class="paragraph"/>    /&#42;&#42;
     &#42; Execute code masquerading as the specified user, <span class="java&#45;keyword">for</span> the duration of the Closure block
     &#42; @<span class="java&#45;keyword">return</span> Whatever the closure returns
     &#42;/
    def withUser(identity, Closure code)
&#125;</pre></div>



<h1 id="events">6 Events API</h1>
Pending


<h1 id="injection">7 Injection API</h1>
Pending


<h1 id="navigation">8 Navigation API</h1>
The Navigation API provides a way to expose the navigational structure of your plugins and applications so that you can merge in functionality from plugins and easily render navigation menus and breadcrumbs.<p class="paragraph"/><h2>Flat vs. Tree navigation, and multiple navigation scopes</h2><p class="paragraph"/>It is generally understood that deep menu navigations are a bad thing for user experience.<p class="paragraph"/>It is usually enough to have a primary and secondary level of main navigation on your site.<p class="paragraph"/>Most sites have other "sub navigation" contexts such as user options like "Log in"/"Sign up"/"Your Profile", and footer nav like "T&#38;Cs", "Privacy Policy", "Contact us" etc that are actually entirely orthogonal navigation structures.<p class="paragraph"/>This API uses a flattened approach with scopes. This serves the basic goals well, and will also provide for those people who also want to have 4-deep nesting of their product catalogue on pop-out menus.<p class="paragraph"/><h2>Scopes</h2><p class="paragraph"/>Navigation scopes provide for the different kinds of menus you have; your main "app" menu, your "user" menu and "footer" menu for example.<p class="paragraph"/>They also provide the basis for rendering secondary navigation based on the currently active primary navigation item.<p class="paragraph"/>You render a menu of a given scope i.e. "app" or "user", or you render a primary/secondary menu based on the current "active path" - the scope of these is worked out for you.<p class="paragraph"/><h2>Active Path</h2><p class="paragraph"/>The active navigation path is set either automatically by inference from the current controller/action.<p class="paragraph"/>Alternatively your GSP views or controllers can set the active path by calling tags/methods.<p class="paragraph"/>This allows you to "fake" active paths for those tricky UI edge cases.<p class="paragraph"/><h2>You can only be in one place at a time. And breadcrumbs</h2><p class="paragraph"/>A major issue with "smart" navigation is determining "where" the user is in your site's navigation structure, so that you can highlight the relevant primary and secondary navigation items as active.<p class="paragraph"/>This is also somewhat related to rendering "breadcrumb trails" that are typically only needed when your users can browse to pages that are not uniquely identified by items in your existing primary and secondary navigation.<p class="paragraph"/>The underlying fact here is that the user can only be on one page at a time, and that means there is usually only one "path" to that place through your navigation.<p class="paragraph"/>There may be augmentations to that current "activation path", i.e. specific document or object names appended to the breadcrumb trail, but you are effectively - no matter how many different menus are rendered on the page, only in one place at a time.<p class="paragraph"/><h2>Automatic Navigation</h2><p class="paragraph"/>By default all your application controllers and actions are added to your site's navigation in the scope "app".<p class="paragraph"/>After installing the platform-core plugin, you can just add the following to your Sitemesh layout to get instant navigatin for all controllers and actions:<p class="paragraph"/><div class="code"><pre>&#60;nav:menu/&#62;</pre></div><p class="paragraph"/>All plugin controllers are automatically added to a "plugin/&#60;pluginName&#62;" scope. (caveat: platform-core controllers are added to a special "dev" scope)<p class="paragraph"/>Both plugins and applications can change the default scope of their controllers trivially by adding a simple convention to the controller:<p class="paragraph"/><div class="code"><pre>class MyController &#123;
    <span class="java&#45;keyword">static</span> navigationScope = <span class="java&#45;quote">"user"</span>
&#125;</pre></div><p class="paragraph"/>This is a simple shortcut. Finer grained control of navigation items is provided by the DSL.<p class="paragraph"/><h2>Declaring Navigation Items</h2><p class="paragraph"/>The Navigation structure for an application is a list of named scope, each containing navigation nodes.<p class="paragraph"/>You can have tiered navigation by rendering the other scopes based on your current active node.<p class="paragraph"/>Nodes identify themselves by "id" and are considered "active" if their activationPath matches the request's current "active path".<p class="paragraph"/>Here's an example navigation structure of a site:<p class="paragraph"/><div class="code"><pre>Main navigation
  |&#45;&#45;&#45;&#45; Home
  |&#45;&#45;&#45;&#45; About
  |&#45;&#45;&#45;&#45; Contact
  |&#45;&#45;&#45;&#45; Log in / Sign up<p class="paragraph"/>Logged&#45;in user navigation
  |&#45;&#45;&#45;&#45; Manage products
  |&#45;&#45;&#45;&#45; Add products
  |&#45;&#45;&#45;&#45; Reports<p class="paragraph"/>Reports sub&#45;options
  |&#45;&#45;&#45;&#45; New report
  |&#45;&#45;&#45;&#45; Saved reports<p class="paragraph"/>Footer navigation
  |&#45;&#45;&#45;&#45; Email us
  |&#45;&#45;&#45;&#45; Call us
  |&#45;&#45;&#45;&#45; Online chat<p class="paragraph"/>Site admin navigation
  |&#45;&#45;&#45;&#45; Admin Reports
  |&#45;&#45;&#45;&#45; User management
  |&#45;&#45;&#45;&#45; Billing management
  |&#45;&#45;&#45;&#45; Debug console</pre></div><p class="paragraph"/>The top level items here are "scopes" and the items beneath them are navigation nodes.<p class="paragraph"/>Navigation nodes can have the following properties:<p class="paragraph"/>| Property | Description 
| id | The unique identifier of this item within this group.
| linkArgs | The map of arguments used to create the link to the item
| activationPath | The path that indicates this node should be shown as active. If the current request active path is 
the same or "deeper" than the current path (delimited by '&#62;' characters) this node will be active
| enabled | A boolean or Closure used to determine if the item should be enabled for the current request
| visible | A boolean or Closure used to determine if the item should be visible for the current request
| titleMessageCode | An i18n message code to use as the navigation text. Defaults to "nav.&#60;id&#62;" where id is the id of the node
| titleDefault | A default string to use as the navigation text if no i18n string is defined. Not recommended. i18n is cleaner<p class="paragraph"/><h2>How to do hierarchical navigation and breadcrumbs</h2><p class="paragraph"/>Every request has an "active path". This is set either automatically by the
built-in filter for controller/action pairs, or in your code or GSP pages
using the &#60;nav:setActivePath path="x:y:z"/&#62; tag.<p class="paragraph"/>The activation path of a navigation node does not have to be unique. This
means that you can have items in different scopes showing as "active" for the
same path, for example if you have different menus for different kinds of users.<p class="paragraph"/><div class="code"><pre>// Capture some beans <span class="java&#45;keyword">for</span> efficiency
def grailsSecurity = grailsApplication.mainContext.grailsSecurity<p class="paragraph"/>def loggedIn = &#123; &#45;&#62;
    grailsSecurity.userLoggedIn
&#125;<p class="paragraph"/>def notLoggedIn = &#123; &#45;&#62;
    !grailsSecurity.userLoggedIn
&#125;<p class="paragraph"/>// Define our structure
navigation = &#123;
    main &#123;
        help view:'help'
        about controller:'content', action:'about'
        contact controller:'contact'
        home controller:'portal'
        dashboard controller:'dashboard' // <span class="java&#45;keyword">default</span> action is index
    &#125;
    user &#123;
        login controller:'user', action:'login', visible: notLoggedIn
        logout controller:'user', action:'logout', visible: loggedIn
        profile controller:'user', action:'profile', visible: notLoggedIn
    &#125;
    dashboard &#123;
        list controller:'products', enabled: loggedIn
        create controller:'products', action:'create', enabled: loggedIn
    &#125;
&#125;</pre></div><p class="paragraph"/>The scope + id defines a nav structure for the app.<p class="paragraph"/>main: help
main: about
main: contact
main: home
main: dashboard
dashboard: list
dashboard: create
user: login
user: logout
user: profile<p class="paragraph"/>You could render nav now for these scopes:<p class="paragraph"/>main
dashboard
user<p class="paragraph"/>If you have non-controller views or other mechanisms that need to control the
active path, you use the &#60;nav:setActivePath path="x/y/z"/&#62; tag to indicate what
the active path should be.<p class="paragraph"/>By default the active path is set to controller name + action name of the current request.<p class="paragraph"/>Tag examples:<p class="paragraph"/>&#60;nav:setActivePath path="'x', 'y', 'z'"/&#62; <hr class="line"/> set active path
&#60;nav:setActivePath path="x:y:z"/&#62; <hr class="line"/> set active path
Path is ${nav.activePath()} --- return current active path
&#60;nav:menu scope="x"/&#62; <hr class="line"/> render menu for given scope. With no scope, defaults to "app"
&#60;nav:breadcrumb/&#62; <hr class="line"/> active path breadcrumb
&#60;nav:breadcrumb path="x:y:z"/&#62; <hr class="line"/> arbitrary breadcrumb<p class="paragraph"/>With the above declarations, a user viewing the "portal" controller will be at
the activation path "home" in the structure and may see a breadcrumb such as "Home".<p class="paragraph"/>A user who is viewing the "products" controller will see a breadcrumb of
either "Dashboard &#62; List" or "Dashboard &#62; Create" depending on
the action they are viewing.<p class="paragraph"/>The text for the breadcrumb would be obtained from i18n bundles based on the navigation id of each step.<p class="paragraph"/>By default all controllers in the application will have a place in the
nevigation structure under scope "app", with their controller and action specifying
their activation path therein.<p class="paragraph"/>Plugin controllers are auto namespaced under root node, so that installing a
plugin does not change your nav immediately.<p class="paragraph"/>To exclude a controller or action, or change their options you use the DSL:<p class="paragraph"/>// Define the navigation structure of our application
// Controllers and their action are automatically mapped into a 
// navigation "scope".
// Default scopes:
// 'app' - for application controllers
// 'user' - for security plugins etc, automatically populated by Security API
// 'plugin/&#60;pluginName&#62;' - for each plugin that exposes controllers
// 'dev' - for dev-time controllers, contains items exposed by platform<p class="paragraph"/>navigation = {<p class="paragraph"/>    overrides {
        // These are app controller/actions we want to exclude from nav
        'debug.*' visible: false
        'inbox.deleted' visible: false<p class="paragraph"/>        // Move app's admin controllers into separate nav scope 'admin'
        'admin.*' scope:'admin'<p class="paragraph"/>        // Remap auto-namespaced plugin nav to main
        // Plugin controllers are namespaced to "plugin/&#60;pluginName&#62;/&#60;controllerName&#62;/&#60;actionName&#62;"
        'activity.activityStream' scope:'app'<p class="paragraph"/>        // Apply security based visibility to plugin's nav items
        'activity.*' visible: loggedIn
    }<p class="paragraph"/>
    // Define the "user" scope
    user {
        signup controller:'register', action:'signup', visible: notLoggedIn<p class="paragraph"/>        // ??? shortcut to set controller for all following
        // controller = 'user' for later maybe<p class="paragraph"/>        login action:'login', visible: notLoggedIn
        logout action:'logout', visible: loggedIn
        profile action:'profile', visible: notLoggedIn
    }
}<p class="paragraph"/>


<h1 id="convention">9 Convention API</h1>
Pending

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Beans</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsConventions.html">grailsConventions</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsEvents.html">grailsEvents</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsInjection.html">grailsInjection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsNavigation.html">grailsNavigation</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsPluginConfiguration.html">grailsPluginConfiguration</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsSecurity.html">grailsSecurity</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Beans/grailsUiHelper.html">grailsUiHelper</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controller Methods</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Controller%20Methods/displayFlashMessage.html">displayFlashMessage</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controller%20Methods/displayMessage.html">displayMessage</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Global Properties</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Global%20Properties/pluginConfig.html">pluginConfig</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plugin Conventions</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Plugin%20Conventions/doWithConfig.html">doWithConfig</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plugin%20Conventions/doWithConfigOptions.html">doWithConfigOptions</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plugin%20Conventions/doWithInjection.html">doWithInjection</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Scripts/update-header.html">update-header</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Service Methods</h1><div class="menu-sub">
                        
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags Security</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:createLoginLink.html">s:createLoginLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:createLogoutLink.html">s:createLogoutLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:createSignupLink.html">s:createSignupLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:identity.html">s:identity</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:ifLoggedIn.html">s:ifLoggedIn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:ifNotLoggedIn.html">s:ifNotLoggedIn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:ifNotPermitted.html">s:ifNotPermitted</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:ifPermitted.html">s:ifPermitted</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:info.html">s:info</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:loginButton.html">s:loginButton</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:logoutButton.html">s:logoutButton</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Security/s:signupButton.html">s:signupButton</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags System</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags%20System/g:config.html">g:config</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20System/g:requiresBean.html">g:requiresBean</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags Ui Extension</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:button.html">g:button</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:callTag.html">g:callTag</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:displayMessage.html">g:displayMessage</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:dummyText.html">g:dummyText</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:joinClasses.html">g:joinClasses</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:label.html">g:label</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:organization.html">g:organization</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:siteLink.html">g:siteLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:siteName.html">g:siteName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:siteURL.html">g:siteURL</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:smartLink.html">g:smartLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags%20Ui%20Extension/g:year.html">g:year</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Utility Classes</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Utility%20Classes/TagLibUtils.html">TagLibUtils</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            &copy; 2012 Marc Palmer & St√©phane Maldini
            Please contact the authors with any corrections or suggestions
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
